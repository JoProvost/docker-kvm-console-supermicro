# Copyright 2016 Internap.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

[program:idle_timeout_job]
priority=1
directory=/
command=/bin/bash -c 'sleep ${CONSOLE_TTL-"3600"}; supervisorctl shutdown'
user=root
autostart=true
stopsignal=KILL
stdout_logfile=/var/log/idle_timeout_job.log
redirect_stderr=true

[program:xinetd]
priority=5
directory=/
command=/usr/sbin/xinetd -dontfork
user=root
autostart=true
autorestart=true
stopsignal=QUIT
environment=HOME="/home/ubuntu"
stdout_logfile=/var/log/xinetd.log
redirect_stderr=true

[group:console]
programs=x11-server,ikvm-viewer,ikvm-resize,vnc-server
priority=999

[program:x11-server]
priority=10
directory=/
command=/usr/bin/Xvfb :1 -screen 0 1200x800x16
user=root
autostart=false
autorestart=true
stopsignal=QUIT
stdout_logfile=/var/log/x11-server.log
redirect_stderr=true

[program:ikvm-viewer]
priority=15
directory=/home/ubuntu
command=/bin/bash -c '/opt/kvm-console/bin/ikvm-viewer.sh $IPMI_ADDRESS $IPMI_USERNAME $IPMI_PASSWORD'
user=ubuntu
autostart=false
autorestart=true
stopsignal=QUIT
environment=DISPLAY=":1",HOME="/home/ubuntu"
stdout_logfile=/var/log/ikvm-viewer.log
redirect_stderr=true

[program:ikvm-resize]
priority=16
directory=/home/ubuntu
command=/opt/kvm-console/bin/ikvm-resize.sh
user=ubuntu
autostart=false
autorestart=true
stopsignal=QUIT
environment=DISPLAY=":1",HOME="/home/ubuntu"
stdout_logfile=/var/log/ikvm-resize.log
redirect_stderr=true
stopsignal=KILL

[program:vnc-server]
priority=20
directory=/
command=/opt/kvm-console/bin/vnc-server.sh java
user=root
autostart=false
autorestart=true
stopsignal=QUIT
environment=DISPLAY=":1",HOME="/home/ubuntu"
stdout_logfile=/var/log/vnc-server.log
redirect_stderr=true
